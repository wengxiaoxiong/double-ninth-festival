<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡é˜³èŠ‚AIè¯—æ­Œåˆ›ä½œ - ä¹ä¹é‡é˜³Â·æ•¬è€æ€äº²</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* Bannerå›¾ç‰‡ */
        .banner {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 50%, #ffd700 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .banner-content {
            text-align: center;
            color: white;
            z-index: 2;
            position: relative;
        }

        .banner-content h1 {
            font-family: 'Noto Serif SC', serif;
            font-size: 36px;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        .banner-content p {
            font-size: 16px;
            opacity: 0.95;
            letter-spacing: 2px;
        }

        .banner-decoration {
            position: absolute;
            font-size: 80px;
            opacity: 0.2;
        }

        .banner-decoration:nth-child(1) {
            top: -20px;
            left: 20px;
            animation: float 6s infinite ease-in-out;
        }

        .banner-decoration:nth-child(2) {
            bottom: -20px;
            right: 20px;
            animation: float 8s infinite ease-in-out 1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            padding: 20px;
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: rgba(255,255,255,0.3);
            z-index: 0;
        }

        .step-item {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
        }

        .step-item.active .step-circle {
            background: white;
            color: #667eea;
            box-shadow: 0 4px 15px rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .step-item.completed .step-circle {
            background: #4caf50;
            color: white;
        }

        .step-label {
            color: white;
            font-size: 12px;
            opacity: 0.8;
        }

        .step-item.active .step-label {
            opacity: 1;
            font-weight: 500;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡å®¹å™¨ */
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 500;
            font-size: 15px;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* å…ƒç´ æ ‡ç­¾ */
        .tags-container {
            margin-bottom: 25px;
        }

        .tags-label {
            display: block;
            margin-bottom: 15px;
            color: #333;
            font-weight: 500;
            font-size: 15px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            user-select: none;
        }

        .tag:hover {
            background: #e8e8e8;
            transform: translateY(-2px);
        }

        .tag.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #f8f9ff;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #667eea;
            font-size: 16px;
            font-weight: 500;
        }

        /* è¯—æ­Œå±•ç¤º */
        .poem-display {
            background: linear-gradient(to bottom, #fff9e6, #fffbf0);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #f0e6d2;
            margin-bottom: 25px;
        }

        .poem-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 24px;
            color: #8b4513;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .poem-text {
            font-family: 'Noto Serif SC', serif;
            font-size: 18px;
            line-height: 2;
            color: #333;
            text-align: center;
        }

        .poem-verse {
            margin-bottom: 10px;
            opacity: 0;
            animation: verseFadeIn 0.6s ease forwards;
        }

        .poem-verse:nth-child(1) { animation-delay: 0.2s; }
        .poem-verse:nth-child(2) { animation-delay: 0.4s; }
        .poem-verse:nth-child(3) { animation-delay: 0.6s; }
        .poem-verse:nth-child(4) { animation-delay: 0.8s; }

        @keyframes verseFadeIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* AIå›¾ç‰‡å±•ç¤º */
        .ai-image-container {
            margin-bottom: 25px;
        }

        .ai-image-preview {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
        }

        .ai-image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ai-image-placeholder {
            text-align: center;
            color: #999;
        }

        .ai-image-placeholder i {
            font-size: 60px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* å…³é”®è¯å±•ç¤º */
        .keywords-box {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .keywords-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .keywords-text {
            font-size: 15px;
            color: #333;
            line-height: 1.6;
        }

        /* åˆ†äº«é¢„è§ˆ */
        .share-final {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .share-image {
            width: 100%;
            height: 400px;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        .share-image-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
        }

        .share-content {
            position: relative;
            z-index: 2;
            width: 100%;
            text-align: center;
        }

        .share-content h2 {
            font-family: 'Noto Serif SC', serif;
            font-size: 28px;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
        }

        .share-poem-box {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .share-poem-text {
            font-family: 'Noto Serif SC', serif;
            font-size: 16px;
            line-height: 1.8;
            color: #333;
        }

        .share-footer-text {
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }

        .share-info {
            padding: 20px;
            text-align: center;
        }

        .share-info-item {
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* æç¤ºæ–‡æœ¬ */
        .hint-text {
            font-size: 13px;
            color: #999;
            margin-top: 8px;
        }

        /* æˆåŠŸæç¤º */
        .success-message {
            background: #4caf50;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å“åº”å¼ */
        @media (max-width: 480px) {
            .banner {
                height: 260px;
            }

            .banner-content h1 {
                font-size: 28px;
            }

            .content {
                padding: 15px;
            }

            .card {
                padding: 20px;
            }

            .share-image {
                height: 400px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Banner -->
    <div class="banner">
        <div class="banner-decoration">ğŸŒ¼</div>
        <div class="banner-decoration">ğŸ‚</div>
        <div class="banner-content">
            <img src="banner_poem.jpg" width="100%">
        </div>
    </div>

    <div class="container">
        <div class="content">
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator">
                <div class="step-item active" id="stepIndicator1">
                    <div class="step-circle">1</div>
                    <div class="step-label">è¾“å…¥ä¿¡æ¯</div>
                </div>
                <div class="step-item" id="stepIndicator2">
                    <div class="step-circle">2</div>
                    <div class="step-label">ç”Ÿæˆå›¾ç‰‡</div>
                </div>
                <div class="step-item" id="stepIndicator3">
                    <div class="step-circle">3</div>
                    <div class="step-label">ç”Ÿæˆåˆ†äº«</div>
                </div>
            </div>

            <!-- æ­¥éª¤1: è¾“å…¥æ‰‹æœºå·å’Œå…³é”®è¯ -->
            <div id="step1" class="page active">
                <div class="card">
                    <div class="input-group">
                        <label for="phone">ğŸ“± æ‰‹æœºå·</label>
                        <input type="tel" id="phone" placeholder="è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·" maxlength="11">
                        <div class="hint-text">ç”¨äºä¿å­˜æ‚¨çš„åˆ›ä½œè®°å½•</div>
                    </div>

                    <div class="input-group">
                        <label for="customText">âœï¸ è‡ªå®šä¹‰å†…å®¹ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="customText" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨æƒ³è¡¨è¾¾çš„å†…å®¹ï¼Œæ¯”å¦‚å¯¹å®¶äººçš„æ€å¿µã€å¯¹é•¿è¾ˆçš„ç¥ç¦..."></textarea>
                    </div>

                    <div class="tags-container">
                        <label class="tags-label">ğŸ·ï¸ é€‰æ‹©é‡é˜³å…ƒç´ ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰</label>
                        <div class="tags" id="elementTags">
                            <div class="tag" data-element="èŠèŠ±">ğŸŒ¼ èŠèŠ±</div>
                            <div class="tag" data-element="ç™»é«˜">â›°ï¸ ç™»é«˜</div>
                            <div class="tag" data-element="èŒ±è¸">ğŸŒ¿ èŒ±è¸</div>
                            <div class="tag" data-element="é‡é˜³ç³•">ğŸ° é‡é˜³ç³•</div>
                            <div class="tag" data-element="æ•¬è€">ğŸ‘´ æ•¬è€</div>
                            <div class="tag" data-element="æ€ä¹¡">ğŸ  æ€ä¹¡</div>
                            <div class="tag" data-element="å›¢åœ†">â¤ï¸ å›¢åœ†</div>
                            <div class="tag" data-element="ç§‹é£">ğŸƒ ç§‹é£</div>
                            <div class="tag" data-element="æ˜æœˆ">ğŸŒ• æ˜æœˆ</div>
                            <div class="tag" data-element="äº²æƒ…">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ äº²æƒ…</div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="generatePoem()">
                        <i class="fas fa-magic"></i> AIåˆ›ä½œè¯—æ­Œ
                    </button>
                </div>
            </div>

            <!-- åŠ è½½é¡µ: AIç”Ÿæˆè¯—æ­Œä¸­ -->
            <div id="loadingPoem" class="page">
                <div class="card">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text" id="loadingPoemText">æ­£åœ¨åˆ†æåˆ›ä½œå…ƒç´ ...</div>
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤2: å±•ç¤ºè¯—æ­Œå¹¶ç”ŸæˆAIå›¾ç‰‡ -->
            <div id="step2" class="page">
                <div class="card">
                    <div class="poem-display">
                        <div class="poem-title" id="poemTitle">é‡é˜³æŠ’æ€€</div>
                        <div class="poem-text" id="poemText"></div>
                    </div>

                    <div class="keywords-box">
                        <div class="keywords-label">ğŸ¨ å·²ä¸ºæ‚¨ç”Ÿæˆå›¾ç‰‡å…³é”®è¯ï¼š</div>
                        <div class="keywords-text" id="imageKeywords"></div>
                    </div>

                    <button class="btn btn-primary" onclick="generateAIImage()">
                        <i class="fas fa-image"></i> ç”ŸæˆAIå›¾ç‰‡
                    </button>
                    <button class="btn btn-secondary" onclick="backToStep1()">
                        <i class="fas fa-redo"></i> é‡æ–°åˆ›ä½œ
                    </button>
                </div>
            </div>

            <!-- åŠ è½½é¡µ: AIç”Ÿæˆå›¾ç‰‡ä¸­ -->
            <div id="loadingImage" class="page">
                <div class="card">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text" id="loadingImageText">æ­£åœ¨ç”ŸæˆAIå›¾ç‰‡...</div>
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤3: å±•ç¤ºå›¾ç‰‡å¹¶ç”Ÿæˆåˆ†äº«é¡µ -->
            <div id="step3" class="page">
                <div class="card">
                    <div class="ai-image-container">
                        <div class="ai-image-preview" id="aiImagePreview">
                            <div class="ai-image-placeholder">
                                <i class="fas fa-image"></i>
                                <p>AIå›¾ç‰‡ç”Ÿæˆä¸­...</p>
                            </div>
                        </div>
                    </div>

                    <div class="poem-display">
                        <div class="poem-title" id="poemTitle2">é‡é˜³æŠ’æ€€</div>
                        <div class="poem-text" id="poemText2"></div>
                    </div>

                    <button class="btn btn-primary" onclick="generateSharePage()">
                        <i class="fas fa-share-alt"></i> ç”Ÿæˆåˆ†äº«é¡µé¢
                    </button>
                    <button class="btn btn-secondary" onclick="regenerateImage()">
                        <i class="fas fa-redo"></i> é‡æ–°ç”Ÿæˆå›¾ç‰‡
                    </button>
                </div>
            </div>

            <!-- æœ€ç»ˆåˆ†äº«é¡µ -->
            <div id="step4" class="page">
                <div class="card">
                    <div class="success-message">
                        âœ… æ‚¨çš„é‡é˜³è¯—æ­Œåˆ†äº«é¡µå·²ç”Ÿæˆï¼
                    </div>

                    <div class="share-final" id="shareFinalPreview">
                        <div class="share-image">
                            <img id="shareImageBg" class="share-image-bg" src="" alt="">
                            <div class="share-content">
                                <h2 id="shareTitle">é‡é˜³æŠ’æ€€</h2>
                                <div class="share-poem-box">
                                    <div class="share-poem-text" id="sharePoemText"></div>
                                </div>
                                <div class="share-footer-text">
                                    ğŸ“… <span id="shareTime"></span>
                                </div>
                            </div>
                        </div>
                        <div class="share-info">
                            <div class="share-info-item">
                                ğŸ“± æ‰‹æœºå·: <span id="sharePhone"></span>
                            </div>
                            <div class="share-info-item">
                                ğŸŒ¾ ç¥æ‚¨é‡é˜³èŠ‚å¿«ä¹ï¼Œé˜–å®¶å¹¸ç¦ï¼
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="downloadShareImage()">
                            <i class="fas fa-download"></i> ä¿å­˜å›¾ç‰‡
                        </button>
                        <button class="btn btn-primary" onclick="copyShareLink()">
                            <i class="fas fa-copy"></i> å¤åˆ¶é“¾æ¥
                        </button>
                    </div>

                    <button class="btn btn-secondary" onclick="createNewPoem()">
                        <i class="fas fa-plus"></i> åˆ›ä½œæ–°è¯—æ­Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let selectedElements = [];
        let currentPoem = null;
        let currentImage = null;
        let imageKeywords = '';

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStepIndicator(currentStep) {
            for (let i = 1; i <= 3; i++) {
                const stepItem = document.getElementById('stepIndicator' + i);
                stepItem.classList.remove('active', 'completed');
                
                if (i < currentStep) {
                    stepItem.classList.add('completed');
                } else if (i === currentStep) {
                    stepItem.classList.add('active');
                }
            }
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        // å…ƒç´ æ ‡ç­¾é€‰æ‹©
        document.getElementById('elementTags').addEventListener('click', (e) => {
            if (e.target.classList.contains('tag')) {
                const element = e.target.dataset.element;
                if (e.target.classList.contains('selected')) {
                    e.target.classList.remove('selected');
                    selectedElements = selectedElements.filter(el => el !== element);
                } else {
                    e.target.classList.add('selected');
                    selectedElements.push(element);
                }
            }
        });

        // æ­¥éª¤1: ç”Ÿæˆè¯—æ­Œ
        function generatePoem() {
            const phone = document.getElementById('phone').value.trim();
            const customText = document.getElementById('customText').value.trim();

            // éªŒè¯æ‰‹æœºå·
            if (!phone) {
                alert('è¯·è¾“å…¥æ‰‹æœºå·ï¼');
                return;
            }
            if (!/^1[3-9]\d{9}$/.test(phone)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ï¼');
                return;
            }

            if (selectedElements.length === 0 && !customText) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé‡é˜³å…ƒç´ æˆ–è¾“å…¥è‡ªå®šä¹‰å†…å®¹ï¼');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½é¡µé¢
            showPage('loadingPoem');

            // æ¨¡æ‹ŸAIç”Ÿæˆè¿‡ç¨‹
            const loadingTexts = [
                'æ­£åœ¨åˆ†æåˆ›ä½œå…ƒç´ ...',
                'æ­£åœ¨æ„æ€è¯—æ­Œæ„å¢ƒ...',
                'æ­£åœ¨é›•ç¢è¯—å¥éŸµå¾‹...',
                'æ­£åœ¨æ·»åŠ é‡é˜³æƒ…æ€€...',
                'åˆ›ä½œå®Œæˆï¼'
            ];

            let step = 0;
            const loadingInterval = setInterval(() => {
                if (step < loadingTexts.length) {
                    document.getElementById('loadingPoemText').textContent = loadingTexts[step];
                    step++;
                } else {
                    clearInterval(loadingInterval);
                    finishPoemGeneration(phone, customText);
                }
            }, 800);
        }

        // å®Œæˆè¯—æ­Œç”Ÿæˆ
        function finishPoemGeneration(phone, customText) {
            // AIè¯—æ­Œç”Ÿæˆï¼ˆæ¨¡æ‹Ÿï¼‰
            const poemTemplates = [
                {
                    title: 'é‡é˜³ç™»é«˜',
                    verses: [
                        'ä¹ä¹ç™»é«˜æœ›è¿œå±±ï¼Œ',
                        'ç§‹é£è§ç‘Ÿå¶é£˜ç„¶ã€‚',
                        'æ‰‹æŒèŒ±è¸æ€æ•…é‡Œï¼Œ',
                        'é¥å¯„äº²æƒ…åˆ°äº‘è¾¹ã€‚'
                    ],
                    keywords: 'ç§‹å¤©å±±å³°ï¼Œé‡‘é»„èŠèŠ±ï¼Œå¤å…¸å±±æ°´ç”»ï¼Œä¸­å›½é£ï¼Œæš–è‰²è°ƒ'
                },
                {
                    title: 'èŠèŠ±é¦™',
                    verses: [
                        'é‡‘èŠç»½æ”¾æ»¡åº­èŠ³ï¼Œ',
                        'é‡é˜³ä½³èŠ‚å€æ€ä¹¡ã€‚',
                        'ä¸¾æ¯é¥ç¥äº²äººå¥ï¼Œ',
                        'ä½†æ„¿é•¿å®‰å…±æ­¤å…‰ã€‚'
                    ],
                    keywords: 'ç››å¼€çš„é‡‘è‰²èŠèŠ±ï¼Œä¸­å¼åº­é™¢ï¼Œç§‹å¤©ï¼Œæ¸©é¦¨æ°›å›´ï¼Œä¸­å›½ç”»é£æ ¼'
                },
                {
                    title: 'æ•¬è€æƒ…æ·±',
                    verses: [
                        'é‡é˜³ä½³èŠ‚å¯„æ·±æƒ…ï¼Œ',
                        'æ•¬è€å°Šè´¤ä»£ä»£æ‰¿ã€‚',
                        'å›¢åœ†æ—¶åˆ»å¿ƒç›¸èšï¼Œ',
                        'å¤©ä¼¦ä¹‹ä¹æš–äººå¿ƒã€‚'
                    ],
                    keywords: 'æ¸©é¦¨å®¶åº­èšä¼šï¼Œç¥–å­™ä¸‰ä»£ï¼ŒèŠèŠ±èŒ¶ï¼Œä¼ ç»Ÿä¸­å¼å®¢å…ï¼Œæ¸©æš–è‰²è°ƒ'
                },
                {
                    title: 'ç§‹æ€',
                    verses: [
                        'æ˜æœˆé«˜æ‚¬ç…§ä¹å·ï¼Œ',
                        'ç§‹é£é€çˆ½ä¸Šé«˜æ¥¼ã€‚',
                        'éæ’èŒ±è¸å°‘ä¸€äººï¼Œ',
                        'ä»–ä¹¡æ¸¸å­æ³ªåŒæµã€‚'
                    ],
                    keywords: 'æ˜æœˆï¼Œå¤å…¸é«˜æ¥¼ï¼Œç§‹å¤©å¤œæ™šï¼ŒèŒ±è¸ï¼Œæ€ä¹¡æ„å¢ƒï¼Œä¸­å›½æ°´å¢¨ç”»é£æ ¼'
                }
            ];

            // æ ¹æ®é€‰æ‹©çš„å…ƒç´ é€‰æ‹©è¯—æ­Œæ¨¡æ¿
            let selectedTemplate = poemTemplates[Math.floor(Math.random() * poemTemplates.length)];

            currentPoem = {
                phone: phone,
                title: selectedTemplate.title,
                verses: selectedTemplate.verses,
                elements: selectedElements,
                customText: customText,
                createTime: new Date().toLocaleString('zh-CN')
            };

            imageKeywords = selectedTemplate.keywords;

            // æ˜¾ç¤ºè¯—æ­Œå’Œå…³é”®è¯
            displayPoemStep2();
        }

        // æ­¥éª¤2: æ˜¾ç¤ºè¯—æ­Œ
        function displayPoemStep2() {
            document.getElementById('poemTitle').textContent = currentPoem.title;
            document.getElementById('imageKeywords').textContent = imageKeywords;
            
            const poemTextDiv = document.getElementById('poemText');
            poemTextDiv.innerHTML = '';
            
            currentPoem.verses.forEach((verse, index) => {
                const verseDiv = document.createElement('div');
                verseDiv.className = 'poem-verse';
                verseDiv.textContent = verse;
                poemTextDiv.appendChild(verseDiv);
            });

            updateStepIndicator(2);
            showPage('step2');
        }

        // æ­¥éª¤2: ç”ŸæˆAIå›¾ç‰‡
        function generateAIImage() {
            showPage('loadingImage');

            const loadingTexts = [
                'æ­£åœ¨åˆ†æè¯—æ­Œæ„å¢ƒ...',
                'æ­£åœ¨æ„å»ºè§†è§‰å…ƒç´ ...',
                'æ­£åœ¨ç»˜åˆ¶AIå›¾ç‰‡...',
                'æ­£åœ¨ä¼˜åŒ–ç”»é¢æ•ˆæœ...',
                'å›¾ç‰‡ç”Ÿæˆå®Œæˆï¼'
            ];

            let step = 0;
            const loadingInterval = setInterval(() => {
                if (step < loadingTexts.length) {
                    document.getElementById('loadingImageText').textContent = loadingTexts[step];
                    step++;
                } else {
                    clearInterval(loadingInterval);
                    finishImageGeneration();
                }
            }, 1000);
        }

        // å®Œæˆå›¾ç‰‡ç”Ÿæˆ
        function finishImageGeneration() {
            // æ¨¡æ‹ŸAIå›¾ç‰‡ï¼ˆä½¿ç”¨æ¸å˜è‰²ä½œä¸ºå ä½ï¼‰
            const gradients = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)'
            ];

            const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];
            
            currentImage = {
                type: 'gradient',
                value: randomGradient,
                keywords: imageKeywords
            };

            displayImageStep3();
        }

        // æ­¥éª¤3: æ˜¾ç¤ºå›¾ç‰‡
        function displayImageStep3() {
            const previewDiv = document.getElementById('aiImagePreview');
            previewDiv.style.background = currentImage.value;
            
            // æ·»åŠ è£…é¥°æ–‡å­—
            previewDiv.innerHTML = `
                <div style="text-align: center; color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.3);">
                    <div style="font-size: 60px; margin-bottom: 10px;">ğŸŒ¼</div>
                    <div style="font-family: 'Noto Serif SC', serif; font-size: 24px; letter-spacing: 3px;">
                        ${currentPoem.title}
                    </div>
                </div>
            `;

            document.getElementById('poemTitle2').textContent = currentPoem.title;
            
            const poemTextDiv2 = document.getElementById('poemText2');
            poemTextDiv2.innerHTML = '';
            
            currentPoem.verses.forEach((verse, index) => {
                const verseDiv = document.createElement('div');
                verseDiv.className = 'poem-verse';
                verseDiv.textContent = verse;
                poemTextDiv2.appendChild(verseDiv);
            });

            updateStepIndicator(3);
            showPage('step3');
        }

        // æ­¥éª¤3: ç”Ÿæˆåˆ†äº«é¡µé¢
        function generateSharePage() {
            // å‡†å¤‡åˆ†äº«å†…å®¹
            document.getElementById('shareTitle').textContent = currentPoem.title;
            document.getElementById('sharePoemText').textContent = currentPoem.verses.join('\n');
            document.getElementById('sharePhone').textContent = currentPoem.phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
            document.getElementById('shareTime').textContent = currentPoem.createTime;

            // è®¾ç½®èƒŒæ™¯
            const shareImageBg = document.getElementById('shareImageBg');
            const shareImageContainer = shareImageBg.parentElement;
            shareImageContainer.style.background = currentImage.value;

            showPage('step4');
        }

        // ä¿å­˜åˆ†äº«å›¾ç‰‡
        function downloadShareImage() {
            alert('ğŸ’¡ æç¤ºï¼šåœ¨çœŸå®åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šå°†åˆ†äº«å¡ç‰‡ç”Ÿæˆä¸ºå›¾ç‰‡å¹¶ä¸‹è½½ã€‚\n\næ‚¨å¯ä»¥ä½¿ç”¨æˆªå›¾å·¥å…·ä¿å­˜å½“å‰åˆ†äº«å¡ç‰‡ï¼');
        }

        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareLink() {
            const shareUrl = window.location.origin + window.location.pathname + '?share=' + Date.now();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('âœ… åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\n' + shareUrl);
                });
            } else {
                alert('ğŸ“ åˆ†äº«é“¾æ¥ï¼š\n' + shareUrl);
            }
        }

        // è¿”å›æ­¥éª¤1
        function backToStep1() {
            if (confirm('ç¡®å®šè¦é‡æ–°åˆ›ä½œå—ï¼Ÿå½“å‰è¯—æ­Œå°†è¢«æ¸…ç©ºã€‚')) {
                updateStepIndicator(1);
                showPage('step1');
            }
        }

        // é‡æ–°ç”Ÿæˆå›¾ç‰‡
        function regenerateImage() {
            if (confirm('ç¡®å®šè¦é‡æ–°ç”Ÿæˆå›¾ç‰‡å—ï¼Ÿ')) {
                generateAIImage();
            }
        }

        // åˆ›å»ºæ–°è¯—æ­Œ
        function createNewPoem() {
            // æ¸…ç©ºè¡¨å•
            document.getElementById('phone').value = '';
            document.getElementById('customText').value = '';
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾é€‰æ‹©
            document.querySelectorAll('.tag').forEach(tag => {
                tag.classList.remove('selected');
            });
            
            selectedElements = [];
            currentPoem = null;
            currentImage = null;
            imageKeywords = '';
            
            updateStepIndicator(1);
            showPage('step1');
        }
    </script>
</body>
</html>